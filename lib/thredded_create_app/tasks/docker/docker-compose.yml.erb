db:
  image: postgres:12-alpine
  ports:
    - "5432:5432"
  environment:
    POSTGRES_USER: root
    POSTGRES_PASSWORD: password
web:
  build: .
  volumes:
    - .:/<%= app_name %>
  working_dir: /<%= app_name %>
  environment:
    DB: postgresql
    DB_HOST: db
    DB_PORT: 5432
    DB_USERNAME: root
    DB_PASSWORD: password
    WEBPACKER_CHECK_YARN_INTEGRITY: "false"
    WEBPACKER_DEV_SERVER_HOST: webpacker
  command: >
    bash -c 'script/wait-for-tcp db 5432 &&
            bin/rails server --port 9292 --binding 0.0.0.0'
  ports:
    - "9292:9292"
  links:
    - db
